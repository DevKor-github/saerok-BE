services:
  app:
    image: ${IMAGE_REF}
    container_name: saerok-prod
    restart: unless-stopped
    init: true
    stop_grace_period: 25s

    ports:
      - "8080:8080"

    # t3.small 자원 컷
    cpus: "1.0"
    cpu_shares: 768
    mem_limit: "1100m"
    mem_reservation: "768m"

    env_file:
      - /run/saerok/env.prod

    ulimits:
      nofile: 65535

    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      JAVA_OPTS: >-
        -Duser.timezone=Asia/Seoul
        -Xms256m -Xmx640m
        -XX:MaxMetaspaceSize=192m
        -XX:MaxDirectMemorySize=48m
        -XX:ReservedCodeCacheSize=96m
        -XX:+UseG1GC
        -XX:+ExitOnOutOfMemoryError

    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"
