services:
  app:
    image: ghcr.io/devkor-github/saerok-be:dev-latest
    container_name: saerok-dev
    restart: unless-stopped
    stop_grace_period: 15s
    ports: ["8080:8080"]

    # t2.micro 안전 제한
    cpus: "0.20"
    mem_limit: "600m"

    # 런타임에 생성한 RAM env 파일을 컨테이너로 그대로 주입
    env_file:
      - /run/saerok/env.dev

    environment:
      # dev 오버레이에서 명시적으로 고정하고 싶은 값만 남김
      SPRING_PROFILES_ACTIVE: "dev"
      JAVA_OPTS: >-
        -Duser.timezone=Asia/Seoul
        -Xms128m -Xmx256m
        -XX:MaxMetaspaceSize=160m
        -XX:MaxDirectMemorySize=32m
        -XX:ReservedCodeCacheSize=48m
        -XX:+UseSerialGC
        -XX:+ExitOnOutOfMemoryError
